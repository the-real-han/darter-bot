# Options Trading Bot

A Python-based trading bot that implements technical analysis strategies for trading options.

## Features

- Data collection from Yahoo Finance
- Technical analysis with multiple indicators
- Options chain data retrieval
- Advanced options trading strategies:
  - Long Call/Put
  - Bull/Bear Put/Call Spreads
  - Iron Condors
- Implied volatility analysis
- Options-specific backtesting
- Performance visualization
- Risk/reward metrics

## Project Structure

```
trading_bot/
├── options_main.py        # Main entry point for options trading
├── data_handler.py        # Handles data fetching and processing
├── options_handler.py     # Handles options data retrieval
├── options_strategy.py    # Implements options trading strategies
├── options_backtest.py    # Implements options backtesting
├── visualization.py       # Visualization tools
├── requirements.txt       # Project dependencies
└── README_options.md      # Options trading documentation
```

## Installation

1. Clone the repository:
```bash
git clone https://github.com/yourusername/trading-bot.git
cd trading-bot
```

2. Create a virtual environment:
```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

3. Install dependencies:
```bash
pip install -r requirements.txt
```

## Usage

### Basic Usage

Run the options trading bot with default settings:

```bash
python options_main.py
```

This will run a backtest on the default symbols (AAPL, MSFT, GOOGL, AMZN, TSLA) using daily data for the past 3 months.

### Command Line Options

- `--symbols`: List of stock symbols to trade options on (e.g., `--symbols AAPL MSFT GOOGL`)
- `--mode`: Trading mode, either 'backtest' or 'live' (e.g., `--mode backtest`)
- `--timeframe`: Data timeframe (e.g., `--timeframe 1d`)
- `--period`: Historical data period (e.g., `--period 3mo`)
- `--output-dir`: Directory to save output files (e.g., `--output-dir /path/to/output`)

Example:
```bash
python options_main.py --symbols AAPL MSFT --mode backtest --timeframe 1d --period 6mo
```

## Options Trading Strategies

The bot implements several options trading strategies based on technical analysis:

### Bullish Strategies

- **Long Call**: Buy at-the-money call options when technical indicators suggest a bullish trend
- **Bull Put Spread**: Sell at-the-money put and buy out-of-the-money put in high IV environments

### Bearish Strategies

- **Long Put**: Buy at-the-money put options when technical indicators suggest a bearish trend
- **Bear Call Spread**: Sell at-the-money call and buy out-of-the-money call in high IV environments

### Neutral Strategies

- **Iron Condor**: Sell out-of-the-money call and put, buy further out-of-the-money call and put when technical indicators suggest a neutral trend

## Technical Analysis

The bot uses several technical indicators to determine market direction:

- **Trend Analysis**: Using moving averages (SMA20, SMA50)
- **Momentum Analysis**: Using RSI and MACD
- **Volatility Analysis**: Using Bollinger Bands

## Backtesting

The options backtesting module simulates options trading with:

- Time decay modeling
- Intrinsic value calculation
- Credit spread modeling
- Performance metrics calculation

## Output Files

All output files generated by the options trading bot are saved to the `output` directory by default:

- Options backtest visualizations (`SYMBOL_options_backtest.png`)
- Portfolio performance charts (`options_portfolio_performance.png`)
- Backtest reports (`options_backtest_report.csv`)
- Log files (`options_trading_bot.log`)

## Disclaimer

This options trading bot is for educational and research purposes only. Options trading involves significant risk and is not suitable for all investors. You should understand the risks involved and consider your investment objectives before trading options.

## License

This project is licensed under the MIT License - see the LICENSE file for details.
## Strategy Configuration

The options trading bot can be configured using JSON configuration files. This allows you to customize the trading strategies without modifying the code.

### Configuration Structure

The configuration file has the following structure:

```json
{
    "version": "1.0.0",
    "general": {
        "risk_per_trade": 0.02,
        "max_positions": 5,
        "position_sizing": "risk_based"
    },
    "technical_indicators": {
        "use_sma": true,
        "use_ema": true,
        "use_macd": true,
        "use_rsi": true,
        "use_bollinger": true,
        "sma_periods": [20, 50, 200],
        "ema_periods": [12, 26],
        "macd_params": {
            "fast_period": 12,
            "slow_period": 26,
            "signal_period": 9
        },
        "rsi_period": 14,
        "bollinger_period": 20,
        "bollinger_std": 2.0
    },
    "options_strategies": {
        "default_strategy": "auto",
        "strategy_selection": {
            "bullish": {
                "low_iv": "long_call",
                "high_iv": "bull_put_spread",
                "iv_threshold": 0.5
            },
            "bearish": {
                "low_iv": "long_put",
                "high_iv": "bear_call_spread",
                "iv_threshold": 0.5
            },
            "neutral": {
                "default": "iron_condor"
            }
        },
        "expiration_selection": "nearest",
        "strike_selection": {
            "call_itm_pct": 0.03,
            "call_otm_pct": 0.05,
            "put_itm_pct": 0.03,
            "put_otm_pct": 0.05
        }
    },
    "signals": {
        "trend_weight": 0.4,
        "momentum_weight": 0.3,
        "volatility_weight": 0.3,
        "signal_threshold": 0.2,
        "confirmation_required": true
    },
    "backtest": {
        "initial_capital": 100000,
        "commission_per_contract": 0.65,
        "slippage_pct": 0.01
    }
}
```

### Using Custom Configuration

To use a custom configuration file:

```bash
python options_main.py --config custom_strategy.json
```

### Saving Default Strategy

You can save the current strategy configuration to `default_strategy.json`:

```bash
python options_main.py --save-default
```

This will extract the current strategy settings and save them to a file that can be used as a reference or starting point for custom configurations.

## Stop Loss and Take Profit

The options trading bot now includes explicit stop loss and take profit functionality:

### Configuration Parameters

```json
"options_strategies": {
    "stop_loss_pct": 0.5,        // Exit if option loses 50% of its value
    "take_profit_pct": 1.0,      // Exit if option gains 100% of its value
    "max_days_to_hold": 14,      // Maximum number of days to hold an options position
    ...
}
```

### How Stop Loss Works

1. When an option position is opened, stop loss and take profit levels are calculated:
   - Stop Loss Price = Entry Price × (1 - stop_loss_pct)
   - Take Profit Price = Entry Price × (1 + take_profit_pct)

2. The position is automatically closed when:
   - The option price falls to or below the stop loss level
   - The option price rises to or above the take profit level
   - The position has been held for more than max_days_to_hold days
   - A signal reversal occurs (e.g., bullish to bearish)

3. Exit reasons are tracked and reported in the backtest results.

### Customizing Risk Parameters

You can customize the risk parameters in your strategy configuration:

```bash
# Use a more conservative strategy with tighter stops
python options_main.py --config custom_strategy.json
```

Example custom configuration with tighter stops:
```json
{
    "options_strategies": {
        "stop_loss_pct": 0.3,        // Exit if option loses 30% of its value
        "take_profit_pct": 0.75,      // Exit if option gains 75% of its value
        "max_days_to_hold": 10        // Hold for maximum of 10 days
    }
}
```
